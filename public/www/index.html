<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Coinserver</title>
    <link rel="stylesheet" href="style.css">
	<!-- The following lines were generated by https://www.favicon-generator.org/ -->
	<link rel="apple-touch-icon" sizes="57x57" href="assets/favicon/apple-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="assets/favicon/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="assets/favicon/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="assets/favicon/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="assets/favicon/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="assets/favicon/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="assets/favicon/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="assets/favicon/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-icon-180x180.png">
	<link rel="icon" type="image/png" sizes="192x192"  href="assets/favicon/android-icon-192x192.png">
	<link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="assets/favicon/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
	<link rel="manifest" href="assets/favicon/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="assets/favicon/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">
  </head>
  <body>
    <nav>
      <button id="homenav" onclick="detectButton('home')">Home</button>
      <button id="singlenav" onclick = "detectButton('single')">Flip one coin</button>
      <button id="multinav" onclick = "detectButton('multi')">Flip multiple coins</button>
      <button id="guessnav" onclick = "detectButton('guess')">Guess the result</button>
    </nav>
    <div id="home">
      <h1>Coin Flipping Game! :o</h1>
      <p>Welcome to this simple coin-flipping website. Press the home button to return to this main page. If you want to flip one coin and see the result, click the "Flip one coin" button. If you'd like to flip multiple coins, click the "Flip multiple coins" button, enter your desired number of flips, and press the flip button. If you'd like to play a game, then click on the "Guess the result" button and try to guess what the next coin will be. Have fun!</p>
    </div>    
    <div id="single" class="hidden">
      <button id="coin">Flip?</button>
		  <p id="active"></p>
      <!-- A result paragraph-->
		  <p>Result: <span id="result"></span></p>
      <!-- An image of a US quarter (North Carolina variant) -->
		  <img src="../assets/img/coin.png" id="quarter">

		  <script >
      // Event listener for whatever is being clicked 
      	document.addEventListener("click", activeNow);
      // Replace text in anything with "active" id
			 function activeNow() {
			 	const active_now = document.activeElement
			 	document.getElementById("active").innerHTML = active_now;
			 	console.log(active_now)
			 }
      // Button coin flip element
			  const coin = document.getElementById("coin")
      // Add event listener for coin button
        coin.addEventListener("click", flipCoin)
        function flipCoin() {
                  fetch('http://localhost:5000/app/flip/', {mode: 'cors'})
            .then(function(response) {
              return response.json();
            })
          .then(function(result) {
            console.log(result);
            document.getElementById("result").innerHTML = result.flip;
            document.getElementById("quarter").setAttribute("src", result.flip+".jpg");
            coin.disabled = true
				})
      	let flip = "FLIPPED"
      	document.getElementById("coin").innerHTML = flip;
      	console.log("Coin has been flipped. Result: "+ flip)
			}
		  </script>
    </div>
    <div id="multi" class="hidden">
      <div id="multi">
        <h1>Flip many coins</h1>
        <form id="coins">
          <label for="number">
            <strong>How many coins?</strong>
          </label>
          <input type="number" name="number" id="number">
          <input type="submit" value="Flip 'em!">
        </form>
  
        <h2>Results</h2>
          <p id="heads"></p>
          <p id="tails"></p>
      </div>
      <script>
        // Our flip many coins form
        const coins = document.getElementById("coins")
        // Add event listener for coins form
        coins.addEventListener("submit", flipCoins)
        // Create the submit handler
        async function flipCoins(event) {
          event.preventDefault();
          
          const endpoint = "app/flip/coins/"
          const url = document.baseURI+endpoint
  
          const formEvent = event.currentTarget
  
          try {
            const formData = new FormData(formEvent);
            const flips = await sendFlips({ url, formData });
  
            console.log(flips);
            document.getElementById("heads").innerHTML = "Heads: "+flips.summary.heads;
            document.getElementById("tails").innerHTML = "Tails: "+flips.summary.tails;
          } catch (error) {
            console.log(error);
          }
        }
        // Create a data sender
        async function sendFlips({ url, formData }) {
          const plainFormData = Object.fromEntries(formData.entries());
          const formDataJson = JSON.stringify(plainFormData);
          console.log(formDataJson);
  
          const options = {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              Accept: "application/json"
            },
            body: formDataJson
          };
  
          const response = await fetch(url, options);
          return response.json()
        }
      </script>
    </div>
    <div id="guess" class="hidden">
      
    </div>
	<script src="../main.js"></script>
  </body>
</html>

